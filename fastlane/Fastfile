# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do

	# åˆ›å»ºèˆªé“
	# ä½¿ç”¨èˆªé“ : fastlane ADManagerLibLane tag: target:
	desc "è‡ªåŠ¨å‘å¸ƒPodsç‰ˆæœ¬"
	lane :JSManagerLibLane do |options|

		# å‚æ•°
		tagName = options[:tag]
		targetName = options[:target]
		commitMessage = options[:commit]

		# å…·ä½“è¿™ä¸ªå··é“ä¸Šé¢æ‰§è¡Œå“ªäº›è¡Œä¸º
		
		# 1. pod install
		cocoapods(clean: true, podfile: "./Example/Podfile")

		# 2. æäº¤ä»£ç 
		# git add .
		git_add(path: ".")
		# git commit -m 'xxx'
		if commitMessage.length > 0
			git_commit(path: ".", message: "#{commitMessage}")
		else
			git_commit(path: ".", message: "ç‰ˆæœ¬å‡çº§ç»´æŠ¤")
		end
		
		# git push origin master
		push_to_git_remote(force: true)

		# 3. æ‰“æ ‡ç­¾ä¹‹å‰, å…ˆéªŒè¯æ ‡ç­¾æ˜¯å¦å­˜åœ¨
		# å¦‚æœå­˜åœ¨, åº”å…ˆåˆ é™¤æœ¬åœ°å’Œè¿œç¨‹æ ‡ç­¾
		# if åˆ¤æ–­æ ‡ç­¾æ˜¯å¦å­˜åœ¨
		# 	æ‰§è¡Œ `åˆ é™¤æœ¬åœ°/è¿œç¨‹æ ‡ç­¾` Action
		# end
		if git_tag_exists(tag: tagName)
		  UI.message("å‘ç°tag:#{tagName} å·²ç»å­˜åœ¨, å³å°†æ‰§è¡Œ, åˆ é™¤åŠ¨ä½œ ğŸš€")
		  remove_tag(tag: tagName)
		end

		# 4. æ‰“æ ‡ç­¾ 
		# git tag æ ‡ç­¾åç§°
		add_git_tag(tag: tagName)
		# git push --tags
		push_git_tags

		# 4. ä¸Šä¼ æè¿°æ–‡ä»¶
		# pod spec lint
		# pod_lib_lint(allow_warnings: true)
		# pod repo push xxx.podspec
		pod_push(path: "#{targetName}.podspec", allow_warnings: true) 
	
	end
end
